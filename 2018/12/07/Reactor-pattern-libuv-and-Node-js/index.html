<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--Description-->
    
    <meta name="description" content="The magic behind the non-blocking nature of Node.js.">
    

    <!--Author-->
    
    <meta name="author" content="Krzysztof Zbiciński">
    

    <!--Social Title-->
    
    <meta property="og:title" content="Reactor pattern, libuv and Node.js" />
    <meta name="twitter:title" content="Reactor pattern, libuv and Node.js" />
    <meta itemprop="name" content="Reactor pattern, libuv and Node.js" />
    

    <!--Social Description-->
    
    <meta property="og:description" content="The magic behind the non-blocking nature of Node.js." />
    <meta name="twitter:description" content="The magic behind the non-blocking nature of Node.js." />
    <meta itemprop="description" content="The magic behind the non-blocking nature of Node.js." />
    

    <!--Open Graph Site Name-->
    <meta property="og:site_name" content="Krzysztof Zbiciński - Blog" />

    <!--Type page-->
    
    <meta property="og:type" content="article" />
    

    <!--Page Cover-->
    
    <meta property="og:image" content="https://zbic.in/2018/12/07/Reactor-pattern-libuv-and-Node-js/cover-70.jpg" />
    <meta name="twitter:image:src" content="https://zbic.in/2018/12/07/Reactor-pattern-libuv-and-Node-js/cover-70.jpg">
    <meta itemprop="image" content="https://zbic.in/2018/12/07/Reactor-pattern-libuv-and-Node-js/cover-70.jpg">
    

    <meta name="twitter:card" content="summary_large_image">
    
    <meta name="twitter:site" content="@zbicin" />
    <meta name="twitter:creator" content="@zbicin">
    

    <!-- Title -->
    
    <title>
        Reactor pattern, libuv and Node.js - Krzysztof Zbiciński - Blog - Pragmatic web development
    </title>

    <!-- Bootstrap Core CSS -->
    <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet" />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/style.css">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet" type="text/css">
    <link href="//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800"
        rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Gallery -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.css" type="text/css" rel="stylesheet" />

    <!-- Google Analytics -->
    
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-27343777-6', 'auto');
        ga('send', 'pageview');

    </script>



    <!-- favicon -->
    
    <link rel="icon" href="/img/code.png">
    

    <!-- atom+xml -->
    <link rel="alternate" type="application/atom+xml" href="/atom.xml" title="Reactor pattern, libuv and Node.js - Krzysztof Zbiciński - Blog - Pragmatic web development" />

    
    <script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
    

</head>

<body>

    <!-- Menu -->
    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Krzysztof Zbiciński - Blog</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                
                    <li>
                        <a href="/">
                            
                                Home
                            
                        </a>
                    </li>
                
                    <li>
                        <a href="/tags">
                            
                                Tags
                            
                        </a>
                    </li>
                
                    <li>
                        <a href="/about">
                            
                                About
                            
                        </a>
                    </li>
                
                    <li>
                        <a href="/atom.xml">
                            
                                RSS
                            
                        </a>
                    </li>
                
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>

    <!-- Main Content -->
    <!-- Page Header -->
<!-- Set your background image for this header in your post front-matter: cover -->

<header class="intro-header" style="background-color: #D5A59D; background-image: url('cover-70.jpg')">
    <div class="backdrop" style="opacity: 0.5"></div>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <h1>Reactor pattern, libuv and Node.js</h1>
                    
                    <h2 class="post-subheading">
                        The magic behind the non-blocking nature of Node.js.
                    </h2>
                    
                    <span class="meta">
                        <!-- Date and Author -->
                        
                            Posted by Krzysztof Zbiciński
                        
                        
                            on
                            2018-12-07.
                        
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

            <!-- Gallery -->
            

            <!-- Post Main Content -->
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <p>Being able to <em>perform non-blocking I/O operations</em> was one of the most vibrant <em>selling points</em> of Node.js back in the days. This article provides an introduction to the reactor pattern, the role of the <em>libuv</em> library and how they both empower Node.js to deal with multitasking pretty much as cool as Xabi Alonso does:</p>
<img src="/2018/12/07/Reactor-pattern-libuv-and-Node-js/xabi.gif" class="center" title="Xabi Alonso playing it cool">
<h2 id="What-is-the-reactor-pattern"><a href="#What-is-the-reactor-pattern" class="headerlink" title="What is the reactor pattern?"></a>What is the reactor pattern?</h2><p>The reactor pattern is one of the most commonly used patterns in web development. There is a pretty good chance that you are very familiar with it without even realizing it. Simply speaking, the application starts listening for an I/O event of a specified type, providing a function that should be launched as a ‘reaction’ to this event. Sounds exactly like JavaScript callbacks, isn’t it? ;)</p>
<p>Thanks to this pattern we can use non-blocking I/O operations, which usually can take some time when being done in a classical, synchronous way (e.g. a database query, an HTTP request, reading a file).</p>
<p>When some part of code requests an I/O operation, the request is put in an <em>Event Queue</em> within an <em>Event Demultiplexer</em>. Then the control is immediatley returned back to the developer’s code. Thanks to this the application doesn’t freeze and can immediately continue with other operations (e.g. performing calculations, listening for UI events and responding to user’s input, etc.). </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// waits until the whole file contents are loaded</span></span><br><span class="line"><span class="keyword">const</span> bigFile1 = fs.readFileSync(<span class="string">'bigFile.txt'</span>); </span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> bigFile2 = <span class="literal">null</span>;</span><br><span class="line"><span class="comment">// requests to load file contents, provides a handler and immediately proceeds with code execution</span></span><br><span class="line">fs.readFile(<span class="string">'bigFile.txt'</span>, <span class="function"><span class="keyword">function</span> <span class="title">handler</span>(<span class="params">err, data</span>) </span>&#123; </span><br><span class="line">  bigFile2 = data;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>In the meantime, the so-called <em>Event Loop</em> processes the events stored in the <em>Event Queue</em>. It iterates through them and invokes the associated functions (<em>callbacks</em> or <em>handlers</em>) when ready.</p>
<p>Let’s see the example pseudocode implementation of an <em>Event Loop</em> taken from the book <a href="https://nikhilm.github.io/uvbook/" target="_blank" rel="noopener"><em>An Introduction to libuv</em></a> by Nikhil Marathe:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">while there are still events to process:</span><br><span class="line">    e = get the next event</span><br><span class="line">    if there is a callback associated with e:</span><br><span class="line">        call the callback</span><br></pre></td></tr></table></figure></p>
<p>Each of the operating systems (Linux, Mac OSX, Windows) has its own implementation of an <em>Event Demultiplexer</em>. Therefore an abstraction layer above those implementations had to be introduced.</p>
<h2 id="libuv-to-the-rescue"><a href="#libuv-to-the-rescue" class="headerlink" title="libuv to the rescue"></a>libuv to the rescue</h2><p>In the early days of Node.js a library called <em>libev</em> was used to handle abstraction above Mac OSX and Linux implementations of <em>Event Demultiplexers</em> (<em>kqueue</em> and <em>(e)poll</em>). As Node.js grew in popularity, this library became insufficient, because support for Windows was demanded as well. </p>
<p>Then the famous <em>libuv</em> was introduced, which covered it all (including Windows implementation: <em>IOCP</em>). It takes the responsibility for collecting events from the operating system or monitoring other sources of events. While being initially developed mostly with Node.js in mind, the <em>libuv</em> library is now widely used by different projects, including Mozilla’s <em>Rust</em> programming language.</p>
<h2 id="How-it-all-fits-together"><a href="#How-it-all-fits-together" class="headerlink" title="How it all fits together?"></a>How it all fits together?</h2><p>I think that the best idea is to show it on a diagram. The architecture of a Node.js application can be presented as follows:</p>
<img src="/2018/12/07/Reactor-pattern-libuv-and-Node-js/NodejsArchitecture.png" class="center" title="Node.js application" alt="s architecture">
<ul>
<li><strong>Application code:</strong> self explanatory ;),</li>
<li><strong>Node.js core:</strong> (also called <em>node-core</em>) is a JavaScript implementation of Node.js APIs,</li>
<li><strong>Bindings:</strong> wrap and expose <em>libuv</em> and other low level functionality to JavaScript,</li>
<li><strong>V8:</strong> execution engine developed initially for Google Chrome,</li>
<li><strong>libuv:</strong> abstraction over <em>Event Demultiplexer</em> of a hosting OS.</li>
</ul>
<h2 id="Final-thoughts"><a href="#Final-thoughts" class="headerlink" title="Final thoughts"></a>Final thoughts</h2><p>I hope this short introduction is a good starting point of learning about the inner mechanisms that make Node.js environment work. We’ve only scratched the surface, so if you’re interested in more detailed information, I can suggest going through the references as the next step. </p>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul>
<li><a href="https://nikhilm.github.io/uvbook/" target="_blank" rel="noopener"><em>An Introduction to libuv</em></a> by Nikhil Marathe</li>
<li><em>Node.js Design Patterns Second Edition</em> by Mario Casciaro, Luciano Mammino</li>
<li><a href="https://hackernoon.com/the-node-js-system-51090c35dddc" target="_blank" rel="noopener"><em>The Node.js System</em></a> by Aman Mittal</li>
</ul>
<p class="unsplash-credit">Photo by <a href="https://unsplash.com/photos/LWnD8U2OReU" target="_blank">Frédéric Paulussen</a> on <a href="https://unsplash.com/" target="_blank">Unsplash</a>.</p> 

                <!-- Tags and categories -->
                
                    <p class="post-tags">
                        
                            Tags: 


<a href="/tags/Node-js/">#Node.js</a> <a href="/tags/JavaScript/">#JavaScript</a>


                        
                    </p>
                    <p class="post-categories">
                        
                    </p>
                
                
                
                    <!-- Go to www.addthis.com/dashboard to customize your tools -->
                    <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-59db9b8d10126f1d"></script>

                    <!-- Go to www.addthis.com/dashboard to customize your tools -->
                    <div class="addthis_inline_share_toolbox"></div>
                
            </div>

            <!-- Comments -->
            
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    
    <hr />
    <h3>Comments:</h3>
    <div id="disqus_thread">
        <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>



                </div>
            
        </div>
    </div>
</article>

    <!-- Footer -->
    <hr />

<!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    
                        <li>
                            <a href="https://twitter.com/zbicin" target="_blank">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                    

                    

                    
                        <li>
                            <a href="https://github.com/zbicin" target="_blank">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                    

                    

                    

                    

                    
                        <li>
                            <a href="/atom.xml" target="_blank">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-feed fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                    
                </ul>
                <p class="copyright text-muted">&copy; 2019 Krzysztof Zbiciński<br></p>
                <p class="copyright text-muted">Original Theme <a target="_blank" href="http://startbootstrap.com/template-overviews/clean-blog/">Clean Blog</a> from <a href="http://startbootstrap.com/" target="_blank">Start Bootstrap</a></p>
                <p class="copyright text-muted">Adapted for <a target="_blank" href="https://hexo.io/">Hexo</a> by <a href="http://www.codeblocq.com/" target="_blank">Jonathan Klughertz</a></p>
            </div>
        </div>
    </div>
</footer>


    <!-- After footer scripts -->
    
<!-- jQuery -->
<script src="//code.jquery.com/jquery-2.1.4.min.js"></script>

<!-- Bootstrap -->
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

<!-- Gallery -->
<script src="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.js" type="text/javascript" charset="utf-8"></script>

<!-- Disqus Comments -->

<script type="text/javascript">
    var disqus_shortname = 'zbicin';

    (function(){
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



</body>

</html>